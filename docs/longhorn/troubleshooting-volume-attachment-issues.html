<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-longhorn/troubleshooting-volume-attachment-issues" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Longhorn Troubleshooting | Automation Suite</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://uipath.github.io/automation-suite-support-tools/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://uipath.github.io/automation-suite-support-tools/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://uipath.github.io/automation-suite-support-tools/docs/longhorn/troubleshooting-volume-attachment-issues"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Longhorn Troubleshooting | Automation Suite"><meta data-rh="true" name="description" content="This is not official documentation for AutomationSuite"><meta data-rh="true" property="og:description" content="This is not official documentation for AutomationSuite"><link data-rh="true" rel="icon" href="/automation-suite-support-tools/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://uipath.github.io/automation-suite-support-tools/docs/longhorn/troubleshooting-volume-attachment-issues"><link data-rh="true" rel="alternate" href="https://uipath.github.io/automation-suite-support-tools/docs/longhorn/troubleshooting-volume-attachment-issues" hreflang="en"><link data-rh="true" rel="alternate" href="https://uipath.github.io/automation-suite-support-tools/docs/longhorn/troubleshooting-volume-attachment-issues" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/automation-suite-support-tools/blog/rss.xml" title="Automation Suite RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/automation-suite-support-tools/blog/atom.xml" title="Automation Suite Atom Feed"><link rel="stylesheet" href="/automation-suite-support-tools/assets/css/styles.88d451f9.css">
<script src="/automation-suite-support-tools/assets/js/runtime~main.1bf4ed0e.js" defer="defer"></script>
<script src="/automation-suite-support-tools/assets/js/main.d65b9327.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/automation-suite-support-tools/"><div class="navbar__logo"><img src="/automation-suite-support-tools/img/uipath_logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/automation-suite-support-tools/img/uipath_logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Automation Suite</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/automation-suite-support-tools/docs/intro">KnowledgeBase</a><a class="navbar__item navbar__link" href="/automation-suite-support-tools/blog">Blogs</a></div><div class="navbar__items navbar__items--right"><a href="https://uipath.github.com/UiPath/automation-suite-support-tools" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/automation-suite-support-tools/docs/intro">AutomationSuite Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/automation-suite-support-tools/docs/category/cheatsheets">Cheatsheets</a><button aria-label="Expand sidebar category &#x27;Cheatsheets&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/automation-suite-support-tools/docs/category/known-issues">Known Issues</a><button aria-label="Expand sidebar category &#x27;Known Issues&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/automation-suite-support-tools/docs/category/networking-troubleshooting">Networking Troubleshooting</a><button aria-label="Expand sidebar category &#x27;Networking Troubleshooting&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/automation-suite-support-tools/docs/category/longhorn-troubleshooting">Longhorn Troubleshooting</a><button aria-label="Collapse sidebar category &#x27;Longhorn Troubleshooting&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/automation-suite-support-tools/docs/longhorn/troubleshooting-volume-attachment-issues">Longhorn Troubleshooting</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/automation-suite-support-tools/docs/category/ceph-troubleshooting">Ceph Troubleshooting</a><button aria-label="Expand sidebar category &#x27;Ceph Troubleshooting&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/automation-suite-support-tools/docs/category/dr-troubleshooting">DR Troubleshooting</a><button aria-label="Expand sidebar category &#x27;DR Troubleshooting&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/automation-suite-support-tools/docs/category/upgrade-troubleshooting">Upgrade Troubleshooting</a><button aria-label="Expand sidebar category &#x27;Upgrade Troubleshooting&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/automation-suite-support-tools/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/automation-suite-support-tools/docs/category/longhorn-troubleshooting"><span itemprop="name">Longhorn Troubleshooting</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Longhorn Troubleshooting</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Longhorn Troubleshooting</h1>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Note</div><div class="admonitionContent_BuS1"><p>This is not official documentation for AutomationSuite</p></div></div>
<p>If longhorn volume is not able to attach/mount to node then pod will remain in ContainerCreating  or Init state and kubectl get events -n POD_NS will have below events</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-monitoring-alertmanager-db]: timed out waiting for the condition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">67s         Warning   FailedMount              pod/alertmanager-rancher-monitoring-alertmanager-1                                                                     Unable to attach or mount volumes: unmounted volumes=[alertmanager-rancher-monitoring-alertmanager-db], unattached volumes=[kube-api-access-smb9d config-volume tls-assets alertmanager-rancher-monitoring-alertmanager-db secret-alertmanager-tls-secret]: timed out waiting for the condition</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Longhorn volume mount may fail with following reasons,</p>
<ol>
<li>
<p>Missing volume.meta file from replica directory</p>
</li>
<li>
<p>Missing metadata for img file</p>
</li>
<li>
<p>Mismatch in PVC size</p>
</li>
<li>
<p>All replicas are faulted</p>
</li>
<li>
<p>Engine image is missing</p>
</li>
<li>
<p>Corrupted meta files from replica directory</p>
</li>
<li>
<p>Pod fails to come up after node reboot due to filesystem corruption</p>
</li>
<li>
<p>TGT not able to login to volume</p>
</li>
<li>
<p>Failure in replica scheduling</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="11-missing-volumemeta-file-from-replica-directory">1.1 Missing volume.meta file from replica directory<a href="#11-missing-volumemeta-file-from-replica-directory" class="hash-link" aria-label="Direct link to 1.1 Missing volume.meta file from replica directory" title="Direct link to 1.1 Missing volume.meta file from replica directory">​</a></h2>
<p>To identify, if volume mount is failing because of missing volume.meta file, check logs of longhorn-manager pod using below command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl  logs -l app=longhorn-manager  -n longhorn-system  -c longhorn-manager --prefix=true  --tail=-1  |grep &quot;Failed to read info in replica directory&quot; | grep &lt;PV NAME&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For example, if pod is not able to mount volume pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6, then command will be:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@server0 ~]# kubectl  logs -l app=longhorn-manager  -n longhorn-system  -c longhorn-manager --prefix=true  --tail=-1  |grep &quot;Failed to read info in replica directory&quot; | grep pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pod/longhorn-manager-7gdqg/longhorn-manager] time=&quot;2023-07-10T11:41:10Z&quot; level=warning msg=&quot;pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6-r-ebc73f6b: time=\&quot;2023-07-10T11:01:41Z\&quot; level=error msg=\&quot;Failed to read info in replica directory /host/datadisk/replicas/pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6-31f5410a: EOF\&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pod/longhorn-manager-7gdqg/longhorn-manager] time=&quot;2023-07-10T11:41:10Z&quot; level=warning msg=&quot;pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6-r-ebc73f6b: time=\&quot;2023-07-10T11:01:42Z\&quot; level=error msg=\&quot;Failed to read info in replica directory /host/datadisk/replicas/pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6-31f5410a: EOF\&quot;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="111-finding-replica-directory">1.1.1 Finding replica directory<a href="#111-finding-replica-directory" class="hash-link" aria-label="Direct link to 1.1.1 Finding replica directory" title="Direct link to 1.1.1 Finding replica directory">​</a></h3>
<ul>
<li>Once, issue is confirmed using above command, scale down workload pods which is consuming this PV.</li>
<li>Post scale-down, We need to check longhorn replica directory to identify which meta file is missing.</li>
</ul>
<p>To identify which server node is having longhorn replica directory, run below command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> kubectl  get replicas.longhorn.io -n longhorn-system -l  longhornvolume=&lt;PV_NAME&gt;  -o custom-columns=&quot;NAME&quot;:.metadata.name,&quot;STATE&quot;:.status.currentState,&quot;NODE&quot;:.spec.nodeID,&quot;DIRECTORY&quot;:.spec.dataDirectoryName</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For our above example, it will be:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@server1 ~]# kubectl  get replicas.longhorn.io -n longhorn-system -l  longhornvolume=pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6  -o custom-columns=&quot;NAME&quot;:.metadata.name,&quot;STATE&quot;:.status.currentState,&quot;NODE&quot;:.spec.nodeID,&quot;DIRECTORY&quot;:.spec.dataDirectoryName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                  STATE     NODE      DIRECTORY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6-r-ebc73f6b   running   server2   pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6-31f5410a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>From above output, replica directory is <code>pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6-31f5410a</code> and located on node server2.</p>
<p>Once replica node is identified, login to replica node and run <code>ls</code> command against replica directory under <code>/datadisk/replicas</code> to identify missing or empty file.</p>
<p>For our above example, complete directory name will be <code>/datadisk/replicas/pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6-31f5410a</code> and sample output of ls command will be as per below:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@server2 ~]# ls -l /datadisk/replicas/pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6-31f5410a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total 102368</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-------. 1 root root       4096 Jul 10 11:00 revision.counter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--. 1 root root 2147483648 Jul 10 11:00 volume-head-006.img</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--. 1 root root        187 Jul 10 10:10 volume-head-006.img.meta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--. 1 root root 2147483648 Jul 10 10:10 volume-snap-uipath-s-d7594081-20a7-4e85-8975-b4d07e7203df.img</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--. 1 root root        197 Jul 10 10:10 volume-snap-uipath-s-d7594081-20a7-4e85-8975-b4d07e7203df.img.meta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--. 1 root root          0 Jul 10 11:01 volume.meta</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="112-recreating-volumemeta-file">1.1.2 Recreating <code>volume.meta</code> file<a href="#112-recreating-volumemeta-file" class="hash-link" aria-label="Direct link to 112-recreating-volumemeta-file" title="Direct link to 112-recreating-volumemeta-file">​</a></h3>
<ul>
<li>From above output, <code>volume.meta</code> file is empty</li>
<li>Use below steps to recreate <code>volume.meta</code> file</li>
</ul>
<p>Format of <code>volume.meta</code> file in pretty-json is as below:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Size&quot;: 2147483648,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Head&quot;: &quot;volume-head-009.img&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Dirty&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Rebuilding&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Error&quot;: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Parent&quot;: &quot;volume-snap-uipath-s-d7594081-20a7-4e85-8975-b4d07e7203df.img&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;SectorSize&quot;: 512,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;BackingFilePath&quot;: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>All meta files will be in compacted format. You can use <code>jq -c</code> to generate compacted format.</p>
<p>where,</p>
<ul>
<li>Size is volume/PV size in Bytes. To get size of PV, run <code>kubectl get &lt;PV_NAME&gt; -o jsonpath=&#x27;{.spec.capacity.storage}&#x27;</code> and convert it into bytes.</li>
<li><code>Head</code> is volume head file name. Format of head file name is <code>volume-head-xxx.img</code></li>
<li><code>Dirty</code> represent volume state</li>
<li><code>Rebuilding</code> defines it volume requires rebuilding or not</li>
<li><code>Error</code> represent any error in volume</li>
<li><code>Parent</code> represent the latest snapshot name. To get latest snapshot name, run <code>ls  -1rth volume-snap*.img | tail -1</code> in replica directory.</li>
<li><code>SectorSize</code> represent volume sector size, it should be always 512.</li>
<li><code>BackingFilePath</code> represent backing file for replica. It is internal to replica and should be empty.</li>
</ul>
<p>Now, to construct <code>volume.meta</code> file for example volume <code>pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6-31f5410a</code> We need Size, Head, Parent and SectorSize information.</p>
<ol>
<li>To get size, run command <code>kubectl get &lt;PV_NAME&gt; -o jsonpath=&#x27;{.spec.capacity.storage}&#x27;</code></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@server1 ~]# kubectl get pv pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6 -o jsonpath=&#x27;{.spec.capacity.storage}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2Gi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Since size if Gi, multiply it with 1024<em>1024</em>1024. So final size will be 2147483648.</li>
<li>If PV size is in Mi, multiply it with 1024*1024.</li>
<li>If it is in Ki, multiple it with 1024.</li>
</ul>
<ol start="2">
<li>To get <code>Head</code> file, run <code>ls volume-head-*.img</code> in replica directory. There will be only one head file in directory.</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@server2 pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6-31f5410a]# ls volume-head-*.img</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">volume-head-006.img</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>To get Parent snapshot, run <code>ls -1rth volume-snap*.img | tail -1</code> in replica directory.</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@server2 pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6-31f5410a]# ls -1rth volume-snap*.img | tail -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">volume-snap-uipath-s-d7594081-20a7-4e85-8975-b4d07e7203df.img</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="4">
<li>
<p>For <code>SectoreSize</code>, it will be default to 512. To verify, check other <code>volume.meta</code> file under <code>/datadisk/replica</code> directory.</p>
<p>Using above information, <code>volume.meta</code> file for our example volume will be,</p>
</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Size&quot;: 2147483648,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Head&quot;: &quot;volume-head-006.img&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Dirty&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Rebuilding&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Error&quot;: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Parent&quot;: &quot;volume-snap-uipath-s-d7594081-20a7-4e85-8975-b4d07e7203df.img&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;SectorSize&quot;: 512,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;BackingFilePath&quot;: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Above output is pretty-json formatted. You can convert it to compact format using <code>jq -c .</code> command. You can write a temporary file in pretty-json format and run <code>cat &lt;TEMP_VOLUME_META&gt; | jq -c . &gt; volume.meta</code> to convert it to compact format.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="12-missing-metadata-for-img-files">1.2 Missing metadata for img files<a href="#12-missing-metadata-for-img-files" class="hash-link" aria-label="Direct link to 1.2 Missing metadata for img files" title="Direct link to 1.2 Missing metadata for img files">​</a></h2>
<p>To identify, if volume mount is failing because of missing metadata for img files, check logs of longhorn-manager pod using below command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl  logs -l app=longhorn-manager  -n longhorn-system  -c longhorn-manager --prefix=true  --tail=-1  |grep Failed to find metadata for | grep &lt;PV NAME&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For example, if pod is not able to mount volume pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6, then command will be:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@server0 pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6-d8b53e98]# kubectl  logs -l app=longhorn-manager  -n longhorn-system  -c longhorn-manager --prefix=true  --tail=-1  |grep &quot;Failed to find metadata for&quot; | grep pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pod/longhorn-manager-7gdqg/longhorn-manager] time=&quot;2023-07-10T17:01:58Z&quot; level=warning msg=&quot;pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6-e-b1e5c2a1: time=\&quot;2023-07-10T17:01:53Z\&quot; level=warning msg=\&quot;failed to create backend with address tcp://10.42.0.72:10060: failed to open replica 10.42.0.72:10060 from remote: rpc error: code = Unknown desc = Failed to find metadata for volume-snap-uipath-s-72f4bc9f-8554-4282-b90b-ad672ab31f8b.img\&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pod/longhorn-manager-7gdqg/longhorn-manager] time=&quot;2023-07-10T17:01:58Z&quot; level=warning msg=&quot;pvc-f1830fec-b3b6-40e1-825f-b17930bfdad6-e-b1e5c2a1: time=\&quot;2023-07-10T17:01:57Z\&quot; level=warning msg=\&quot;failed to create backend with address tcp://10.42.0.72:10060: failed to open replica 10.42.0.72:10060 from remote: rpc error: code = Unknown desc = Failed to find metadata for volume-snap-uipath-s-72f4bc9f-8554-4282-b90b-ad672ab31f8b.img\&quot;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To find relevant replica directory for volume, follow steps from 1.1.1</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="121-to-recreate-volume-head-xxximgmeta-file">1.2.1 To recreate volume-head-xxx.img.meta file<a href="#121-to-recreate-volume-head-xxximgmeta-file" class="hash-link" aria-label="Direct link to 1.2.1 To recreate volume-head-xxx.img.meta file" title="Direct link to 1.2.1 To recreate volume-head-xxx.img.meta file">​</a></h3>
<p>In replica directory, there will be only one <code>volume-head-xxx.img</code> data file and one <code>volume-head-xxx.img.meta</code> meta file. Name of the meta file will be same as <code>volume-head-xxx.img</code> with suffix .meta.</p>
<p>Format of <code>volume-head-xxx.img.meta</code>file is as below:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Name&quot;: &quot;volume-head-007.img&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Parent&quot;: &quot;volume-snap-1670c0ce-4cee-4bb1-addb-f6d00b03f9f9.img&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Removed&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;UserCreated&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Created&quot;: &quot;2023-07-10T10:10:22Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Labels&quot;: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Where,</p>
<ul>
<li><code>Name</code> is  volume-head file name. It will be in <code>volume-head-xxx.img</code> format. This file contains the data of volume.</li>
<li><code>Parent</code> is latest snapshot name. To get latest snapshot name, run <code>ls -1rth volume-snap*.img | tail -1</code> in replica directory.</li>
<li><code>Removed</code> defines if this file is removed. For <code>volume-head</code> It will be false</li>
<li><code>UserCreated</code> defines if this file is created by use, not longhorn. Value of this field will be false by default.</li>
<li><code>Created</code> represent creation time-stamp of <code>volume-head</code> file. You can set it to timestamp of <code>volume-head</code> file</li>
<li><code>Labels</code> represent labels of volume-head. Default value for this will be <code>null</code></li>
</ul>
<p>Based on above information, To re-construct <code>volume-head-xxx.img.meta</code> file, We need Name, Parent and Created values.</p>
<ul>
<li>To get Name , run <code>ls -1 volume-head-*.img</code> in relevant replica directory.</li>
<li>To get Parent snapshot name, run <code>ls -1rth volume-snap*.img | tail -1</code></li>
<li>To get Created, run <code>date -u -d @</code>stat -c &#x27;%X&#x27; volume-head-*.img<code>   +&quot;%Y-%m-%dT%H:%M:%SZ&quot;</code></li>
</ul>
<p>Using above information, <code>volume-head-xxx.img.meta</code> file for our example volume will be,</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Name&quot;: &quot;volume-head-006.img&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Parent&quot;: &quot;volume-snap-uipath-s-d7594081-20a7-4e85-8975-b4d07e7203df.img&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Removed&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;UserCreated&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Created&quot;: &quot;2023-07-10T15:20:08Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Labels&quot;: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Above output is <code>pretty-json</code> formatted. You can convert it to compact format using <code>jq -c .</code> command. You can write a temporary file in pretty-json format and run <code>cat &lt;TEMP_VOLUME_META&gt; | jq -c . &gt; volume-head-xxx.img.meta</code> to convert it to compact format.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="122-to-recreate-volume-snap-xxximgmeta-file">1.2.2 To recreate volume-snap-xxx.img.meta file<a href="#122-to-recreate-volume-snap-xxximgmeta-file" class="hash-link" aria-label="Direct link to 1.2.2 To recreate volume-snap-xxx.img.meta file" title="Direct link to 1.2.2 To recreate volume-snap-xxx.img.meta file">​</a></h3>
<p>In replica directory, there will be multiple <code>volume-snap-xxx.img</code> data files along with its <code>volume-snap-xxx.img.meta</code> meta files. Meta file for relevant snapshot file will be having same name with suffix <code>.meta</code>.</p>
<p>Format of <code>volume-snap-xxx.img.meta</code> file is as below:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Name&quot;: &quot;volume-snap-1670c0ce-4cee-4bb1-addb-f6d00b03f9f9.img&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Parent&quot;: &quot;volume-snap-uipath-s-d7594081-20a7-4e85-8975-b4d07e7203df.img&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Removed&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;UserCreated&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Created&quot;: &quot;2023-07-10T14:20:22Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Labels&quot;: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Where,</p>
<ul>
<li><code>Name</code> is  volume-snap file name. It will be in <code>volume-snap-xxx.img</code> format. This file contains the data of snapshot.</li>
<li><code>Parent</code> is latest snapshot name older than the snapshot we are fixing. To get latest snapshot name older to current one , list snapshot images <code>volume-snap-*.img</code> in timestamp order and select the recent older snapshot before the snapshot for which we are fixing the meta file. If there are no any older snapshot then leave Parent field empty.</li>
<li><code>Removed</code> defines if this file is removed. If Parent field is empty then set Removed as false.</li>
<li><code>UserCreated</code> defines if this file is created by use, not longhorn. Value of this field will be true if snapshot is having <code>volume-snap-uipath-xx</code> format else false by default</li>
<li><code>Created</code> represent creation time-stamp of <code>volume-snap-x</code> file. You can set it to timestamp of <code>volume-snap-x</code> file</li>
<li><code>Labels</code> represent labels of volume-head. Default value for this will be <code>null</code>. If snapshot was created by recurring job , i.e uipath-snapshot, then set Labels to <code>{&quot;RecurringJob&quot;: &quot;uipath-snapshot&quot;}</code></li>
</ul>
<p>Once you have all above information, you can construct <code>volume-snap-xxx.img.meta</code> file as below, compact it and save it.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Name&quot;: &quot;volume-snap-uipath-s-239a4ab1-7d53-4427-9ce9-fc0185fbfa77.img&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Parent&quot;: &quot;volume-snap-uipath-s-903643d4-f8e0-4f24-8e33-86c7c1680c3d.img&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Removed&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;UserCreated&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Created&quot;: &quot;2023-07-10T14:10:04Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Labels&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;RecurringJob&quot;: &quot;uipath-snapshot&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Above output is <code>pretty-json</code> formatted. You can convert it to compact format using <code>jq -c .</code> command. You can write a temporary file in <code>pretty-json</code> format and run <code>cat &lt;TEMP_VOLUME_META&gt; | jq -c . &gt; volume-snap-xxx.img.meta</code> to convert it to compact format.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="13-mismatch-in-pvc-size">1.3 Mismatch in PVC size<a href="#13-mismatch-in-pvc-size" class="hash-link" aria-label="Direct link to 1.3 Mismatch in PVC size" title="Direct link to 1.3 Mismatch in PVC size">​</a></h2>
<p>If longhorn volume remains in attaching-detaching state, there might be an issue with PVC size. To confirm, if volume is not able to attach because of PVC size mismatch, run below command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> kubectl  logs -n longhorn-system -l longhorn.io/instance-manager-type=engine --prefix=true  --tail=-1 |grep &quot;BUG: Backend sizes do not match&quot; |grep &lt;PV_NAME&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Sample output of above command will be as below:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@server0 ~]# kubectl  logs -n longhorn-system -l longhorn.io/instance-manager-type=engine --prefix=true  --tail=-1 |grep &quot;BUG: Backend sizes do not match&quot; |grep pvc-f322bf2f-7448-490c-9032-3d337cc5c858</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pod/instance-manager-e-18648e5c/engine-manager] [pvc-f322bf2f-7448-490c-9032-3d337cc5c858-e-9fa69db1] 2023/07/11 07:21:15 BUG: Backend sizes do not match 2147483648 != 524288000 in the engine initiation phase</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In above example, <code>pvc-f322bf2f-7448-490c-9032-3d337cc5c858</code> size is incorrect.</p>
<p>To fix this issue,</p>
<ul>
<li>Scale down workload pods</li>
<li>Edit <code>volumes.longhorn.io</code> object for relevant PV using command <code>kubectl edit volumes.longhorn.io -n longhorn-system &lt;PV_NAME&gt;</code> and make <code>spec.nodeID</code> field empty(&quot;&quot;).</li>
<li>Resize PVC object to correct size. To resize, run <code>kubectl edit pvc -n &lt;NS&gt; &lt;PVC_NAME&gt; and update spec.resources.requests.storage</code> to correct value.</li>
<li>Check <code>volume.meta</code> file’s content of relevant replica directory. If size is not correct, update the size in <code>volume.meta</code> file. Please refer 1.1.1 to fetch replica directory.</li>
<li>Scale up workload pods.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="14-all-replicas-are-faulted">1.4 All replicas are faulted<a href="#14-all-replicas-are-faulted" class="hash-link" aria-label="Direct link to 1.4 All replicas are faulted" title="Direct link to 1.4 All replicas are faulted">​</a></h2>
<p>If longhorn replicas are in faulted state and requires manual salvage then volume may not be able to attach and remain in detach state.</p>
<p>To identify if volume requires manual salvage, Run below commands:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl  logs -l app=longhorn-manager  -n longhorn-system  -c longhorn-manager --prefix=true  --tail=-1  |grep &quot;set engine salvageRequested to true&quot; | grep &lt;PV NAME&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Sample output of above command will be as below:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2023-11-20T18:22:16.667609096+11:00 time=&quot;2023-11-20T07:22:16Z&quot; level=info msg=&quot;All replicas are failed, set engine salvageRequested to true&quot; accessMode=rwo controller=longhorn-volume frontend=blockdev migratable=false node=rpa-suite-dev-01.it.csiro.au owner=rpa-suite-dev-01.it.csiro.au state=detaching volume=pvc-031fd6bc-9cfe-420a-9213-da38509d733a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To fix this issue,</p>
<ul>
<li>Scale down workload pods</li>
<li>Find replicas of relevant volume using command <code>kubectl get replicas.longhorn.io -n longhorn-system |grep &lt;PV_NAME&gt;</code></li>
<li>Edit replicas.longhorn.io object for relevant PV using command <code>kubectl edit replicas.longhorn.io -n longhorn-system &lt;REPLICA_NAME&gt;</code> and set <code>spec.failedat</code> field empty(&quot;&quot;).</li>
<li>Scale up workload pods.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="15-engine-image-is-missing">1.5 Engine image is missing<a href="#15-engine-image-is-missing" class="hash-link" aria-label="Direct link to 1.5 Engine image is missing" title="Direct link to 1.5 Engine image is missing">​</a></h2>
<p>Longhorn uses engine image to deploy the volume. This engine image is tightly coupled with installed longhorn version, longhorn version 1.3.3 requires engine image 1.3.3 only.</p>
<p>Upgrading longhorn doesn’t upgrade engine image to respective version. There are few scenarios in which longhorn may upgrade the engine image, like node reboot, volume detach-attach. But this is not guaranteed as this may leaves few volume with old image.</p>
<p>To identify if volume is not able to attach because of this issue, run below command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl  logs -l app=longhorn-manager  -n longhorn-system  -c longhorn-manager --prefix=true  --tail=-1  |grep &quot;is not deployed on at least one of the the replicas&quot; | grep &lt;PV NAME&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Sample output of above command will be as below:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2023-11-23T13:55:26.306811530Z time=&quot;2023-11-23T13:55:26Z&quot; level=warning msg=&quot;HTTP handling error unable to attach volume pvc-8aaf3ecd-9812-46ce-9eed-b41a95a08106 to czchols5558.prg-dc.dhl.com: cannot attach volume pvc-8aaf3ecd-9812-46ce-9eed-b41a95a08106 because the engine image longhornio/longhorn-engine:v1.2.2 is not deployed on at least one of the the replicas&#x27; nodes or the node that the volume is going to attach to&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To fix this issue,</p>
<ul>
<li>Scale down workload pods</li>
<li>Open errored volume in longhorn UI and select upgrade engine, choose latest available engine image.</li>
<li>Scale up workload pods</li>
</ul>
<p>If there are number of volumes running into this issue, you can run below script which will upgrade all the volumes to the given version <a target="_blank" href="/automation-suite-support-tools/assets/files/longhorn-upgrade-engines-899526a394ed4e7e58c80836ada40bdc.sh">longhorn_engines_upgrade.sh</a></p>
<p>Note: If there are already volumes which are not being able to attach then uncomment <code>ENABLE BELOW RETURN</code> block and run the script.</p>
<p>In case of offline installation, if old engine image doesn’t exist in docker-registry then above script or manual upgrade from UI will fail. Before upgrading to latest version, You need to seed old engine image to docker-registry.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="16-corrupted-meta-files-from-replica-directory">1.6 Corrupted meta files from replica directory<a href="#16-corrupted-meta-files-from-replica-directory" class="hash-link" aria-label="Direct link to 1.6 Corrupted meta files from replica directory" title="Direct link to 1.6 Corrupted meta files from replica directory">​</a></h2>
<p>Similar to section 1.2</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="17-pod-fails-to-come-up-after-node-reboot-due-to-filesystem-corruption">1.7 Pod fails to come up after node reboot due to filesystem corruption<a href="#17-pod-fails-to-come-up-after-node-reboot-due-to-filesystem-corruption" class="hash-link" aria-label="Direct link to 1.7 Pod fails to come up after node reboot due to filesystem corruption" title="Direct link to 1.7 Pod fails to come up after node reboot due to filesystem corruption">​</a></h2>
<p>Sometimes when host gets rebooted the insights-insightslooker pod fails to come up due to volume attachment issue. When this happens the insights app gets stuck in progressing state</p>
<p><img loading="lazy" alt="LonghornVolumeStuck" src="/automation-suite-support-tools/assets/images/longhorn-insights-stuck-6f69c20e6d366df3c3d06763d65116be.png" width="1520" height="640" class="img_ev3q"></p>
<p>Go the insights-insightslooker pod in argocd ui, the events for the pod should show error message like below.</p>
<p><img loading="lazy" alt="LonghornFailedMount" src="/automation-suite-support-tools/assets/images/longhorn-failed-mount-event-aae8e8a8cb9818aa2fb69497a632f690.png" width="1195" height="234" class="img_ev3q"></p>
<p><strong>Solution:</strong></p>
<ol>
<li>Identify the volume from the above message here its <code>pvc-5abe3c8f-7422-44da-9132-92be5641150a</code></li>
<li>Scale down the workload which using the errored volume. Ensure that volume is detached from the node. You can check output of <code>kubectl get volumes.longhorn.io -n longhorn-system |grep &lt;PV&gt;</code> to verify volume is detached.</li>
<li>Manually attach the errored volume to any node from longhorn UI.</li>
<li>Login to the node and fix the device corresponding to that volume.</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fsck.ext4 /dev/longhorn/&lt;ERRORED_VOLUME&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:
<img loading="lazy" alt="LonghornFSCK" src="/automation-suite-support-tools/assets/images/longhorn-fsck-36c595005b9ba78c0fec148ee021e9ff.png" width="1520" height="778" class="img_ev3q"></p>
<ol start="5">
<li>Once errored volume is repaired, detach it from the node. This can be done from longhorn UI.</li>
<li>Scale up the workload.</li>
</ol>
<p>The pod should come up automatically and after sometime the pod becomes healthy.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://uipath.github.com/UiPath/automation-suite-support-tools/edit/master/docs/docs/longhorn/troubleshooting-volume-attachment-issues.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/automation-suite-support-tools/docs/category/longhorn-troubleshooting"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Longhorn Troubleshooting</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/automation-suite-support-tools/docs/category/ceph-troubleshooting"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Ceph Troubleshooting</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#11-missing-volumemeta-file-from-replica-directory" class="table-of-contents__link toc-highlight">1.1 Missing volume.meta file from replica directory</a><ul><li><a href="#111-finding-replica-directory" class="table-of-contents__link toc-highlight">1.1.1 Finding replica directory</a></li><li><a href="#112-recreating-volumemeta-file" class="table-of-contents__link toc-highlight">1.1.2 Recreating <code>volume.meta</code> file</a></li></ul></li><li><a href="#12-missing-metadata-for-img-files" class="table-of-contents__link toc-highlight">1.2 Missing metadata for img files</a><ul><li><a href="#121-to-recreate-volume-head-xxximgmeta-file" class="table-of-contents__link toc-highlight">1.2.1 To recreate volume-head-xxx.img.meta file</a></li><li><a href="#122-to-recreate-volume-snap-xxximgmeta-file" class="table-of-contents__link toc-highlight">1.2.2 To recreate volume-snap-xxx.img.meta file</a></li></ul></li><li><a href="#13-mismatch-in-pvc-size" class="table-of-contents__link toc-highlight">1.3 Mismatch in PVC size</a></li><li><a href="#14-all-replicas-are-faulted" class="table-of-contents__link toc-highlight">1.4 All replicas are faulted</a></li><li><a href="#15-engine-image-is-missing" class="table-of-contents__link toc-highlight">1.5 Engine image is missing</a></li><li><a href="#16-corrupted-meta-files-from-replica-directory" class="table-of-contents__link toc-highlight">1.6 Corrupted meta files from replica directory</a></li><li><a href="#17-pod-fails-to-come-up-after-node-reboot-due-to-filesystem-corruption" class="table-of-contents__link toc-highlight">1.7 Pod fails to come up after node reboot due to filesystem corruption</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/automation-suite-support-tools/docs/intro">OfficialDocs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Forum</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://forum.uipath.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">UiPath Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/automation-suite-support-tools/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 This Project is Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>